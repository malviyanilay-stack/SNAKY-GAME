<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Snake.io Multiplayer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <style>
    body { background: #181920; margin: 0; font-family: sans-serif; overflow:hidden;}
    #game { background:#222; margin:20px auto 0; display:block; border:3px solid #2f8; }
    #score { color: #2f8; text-align: center; font-size: 2em; padding-top:10px;}
    #touches { position:fixed;bottom:10px;left:0;right:0;text-align:center;}
    .btn {width:66px;height:66px;margin:8px;background:#232;border:2px solid #2f8;border-radius:50%;display:inline-block;line-height:66px;font-size:2em;color:#fff;user-select:none;}
  </style>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>
<body>
  <canvas id="game" width="340" height="340"></canvas>
  <div id="score"></div>
  <div id="touches">
    <div class="btn" id="btnLeft">&#8592;</div>
    <div class="btn" id="btnUp">&#8593;</div>
    <div class="btn" id="btnDown">&#8595;</div>
    <div class="btn" id="btnRight">&#8594;</div>
  </div>
<script>
const socket = io('https://supreme-octo-palm-tree-5x9j.onrender.com/');

const roomName = prompt("Room name?") || "default";
const playerName = prompt("Your nickname?") || "anon";
socket.emit("joinRoom", {room:roomName, name:playerName});

const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const scale = 17, rows = 20, cols = 20;
let dir = "right", score=0, gameOver=false, snake=[{x:2,y:2}], food={x:10, y:10};
let players = {};

function draw() {
  ctx.fillStyle="#222"; ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#f22"; ctx.fillRect(food.x*scale, food.y*scale, scale, scale);

  Object.values(players).forEach(p=>{
    p.snake.forEach((seg,i)=>{
      ctx.fillStyle = i ? "#2f8" : (p.id === socket.id ? "#fff" : "#8cf");
      ctx.fillRect(seg.x*scale, seg.y*scale, scale, scale);
    });
    ctx.fillStyle="#fff";
    ctx.font="16px sans-serif";
    ctx.fillText(p.name, p.snake[0].x*scale, p.snake[0].y*scale-4);
  });
  document.getElementById('score').textContent =
    gameOver ? "Game Over! Tap any direction to restart" : "Score: "+score;
}

function setDir(d) {
  if(d==="up" && dir!=="down") dir="up";
  else if(d==="down" && dir!=="up") dir="down";
  else if(d==="left" && dir!=="right") dir="left";
  else if(d==="right" && dir!=="left") dir="right";
  if(gameOver) restart();
  socket.emit("move", {dir});
}
["Left","Up","Down","Right"].forEach(d=>{
  document.getElementById("btn"+d).onclick = ()=>setDir(d.toLowerCase());
});

function restart(){
  snake = [{x:2,y:2}], dir="right", score=0, gameOver=false, food={x:10, y:10};
  socket.emit("restart");
}
function moveSnake(){
  if(gameOver) return;
  let head = {...snake[0]};
  if(dir=="up") head.y--;
  if(dir=="down") head.y++;
  if(dir=="left") head.x--;
  if(dir=="right") head.x++;
  if(head.x<0||head.x>=cols||head.y<0||head.y>=rows
     || snake.some(p=>p.x==head.x&&p.y==head.y)) {
    gameOver=true; draw();
    return;
  }
  snake.unshift(head);
  if(head.x==food.x&&head.y==food.y){
    score++;
    socket.emit("eatFood");
  } else {
    snake.pop();
  }
  socket.emit("update", {snake, score});
  draw();
}
setInterval(moveSnake, 120);

socket.on("gameState", data => {
  players = data.players;
  food = data.food;
  draw();
});
socket.on("dead", ()=>{ gameOver=true; draw(); });

</script>
</body>
</html>
